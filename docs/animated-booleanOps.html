<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Boolean Operations</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="paper2-docs.css" />
    <script src="./paper2-web-comps.js"></script>
    <script src="./paper2-stackblitz.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
  </head>
  <body>
    <paper2-nav></paper2-nav>
    <header style="text-align: center">
      <h1>Boolean Operations</h1>
      <paper2-stackblitz></paper2-stackblitz>
      <p>&nbsp;</p>
    </header>
    <main>
      <canvas id="myCanvas" resize></canvas>
    </main>
    <script src="./paper2-ga.js"></script>
    <!-- type="text/paperscript" -->
    <script id="mainPaper2Script1" canvas="myCanvas" type="text/paperscript">
      var stopAt = window.Cypress ? 60 : Infinity; // Doing this so we can have Cypress test
      var counter = 0;

      var text = new PointText({
        position: view.center + [0, 200],
        fillColor: "black",
        justification: "center",
        fontSize: 20,
      });

      var originals = new Group({ insert: false }); // Don't insert in DOM.

      var square = new Path.Rectangle({
        position: view.center,
        size: 300,
        parent: originals,
        fillColor: new Color("white"),
      });

      // Make a ring using subtraction of two circles:
      var inner = new Path.Circle({
        center: view.center,
        radius: 100,
        parent: originals,
        fillColor: new Color("white"),
      });

      var outer = new Path.Circle({
        center: view.center,
        radius: 140,
        parent: originals,
        fillColor: new Color("white"),
      });

      var ring = outer.subtract(inner);

      var operations = ["unite", "intersect", "subtract", "exclude", "divide"];
      var colors = ["red", "green", "blue", "black"];
      var curIndex = -1;
      var operation, result, activeItem;

      // Change the mode every 3 seconds:
      setInterval(setMode, 3000);

      // Set the initial mode:
      setMode();

      function setMode() {
        curIndex++;
        if (curIndex == operations.length * 2) curIndex = 0;
        operation = operations[curIndex % operations.length];
      }

      function onMouseDown(event) {
        var hitResult = originals.hitTest(event.point);
        activeItem = hitResult && hitResult.item;
      }

      function onMouseDrag(event) {
        if (activeItem) activeItem.position = event.point;
      }

      function onMouseUp() {
        activeItem = null;
        square.position = view.center;
      }

      function onFrame(event) {
        counter += 1;

        if (counter < stopAt) {
          if (activeItem != ring) {
            // Move the ring around:
            var offset =
              new Point(140, 80) *
              [Math.sin(event.count / 60), Math.sin(event.count / 40)];
            ring.position = view.center + offset;
          }

          // Remove the result of the last path operation:
          if (result) result.remove();

          // Perform the path operation on the ring:
          if (curIndex < operations.length) {
            result = square[operation](ring);
            text.content = "square." + operation + "(ring)";
          } else {
            result = ring[operation](square);
            text.content = "ring." + operation + "(square)";
          }
          result.selected = true;
          result.fillColor = colors[curIndex % colors.length];
          result.moveBelow(text);

          // If the result is a group, color each of its children differently:
          if (result instanceof Group) {
            for (var i = 0; i < result.children.length; i++) {
              result.children[i].fillColor = colors[i];
            }
          }
        }
      }

      function onResize() {
        text.position = view.center + [0, 200];
        square.position = view.center;
      }
    </script>
    <script id="mainPaper2Script2">
      const resourceUri =
        location.hostname === "localhost"
          ? "./paper2.js"
          : "https://unpkg.com/paper2/paper2.js";

      import(resourceUri).catch((err) => console.log("err: ", err));
    </script>
  </body>
</html>
