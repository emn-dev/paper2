<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Path Intersections</title>
    <style>
      /* Scale canvas with resize attribute to full size */
      canvas[resize] {
        width: 100%;
        height: 100%;
        background-color: lightgray;
      }
    </style>
    <!-- <link rel="stylesheet" href="../css/style.css" /> -->
    <!-- <script type="text/javascript" src="../../dist/paper-full.js"></script> -->
    <!-- <script
      type="text/javascript"
      src="https://unpkg.com/paper@0.12.18/dist/paper-full.js"
    ></script> -->
    <script
      type="text/javascript"
      src="https://unpkg.com/paper@0.12.18/dist/paper-core.js"
    ></script>
  </head>
  <body>
    <canvas id="myCanvas" resize></canvas>
    <script>
      // paper.install(window);
      //   console.log("asdfasdf");
      //   console.log(window.paper);
      //   const defaultProject = new paper.Project("myCanvas");
      // var canvas = document.getElementById("myCanvas");
      paper.setup("myCanvas");
      // const defaultProject = paper;
      // const defaultProject = new paper.Project("myCanvas");
      //   console.log(defaultProject);
      var text = new paper.PointText({
        position: defaultProject.view.center + [0, 200],
        fillColor: "black",
        justification: "center",
        fontSize: 20,
      });

      var originals = new paper.Group({ insert: true }); // Don't insert in DOM.

      var square = new paper.Path.Rectangle({
        position: defaultProject.view.center,
        size: 300,
        parent: originals,
        fillColor: "gray",
      });

      // Make a ring using subtraction of two circles:
      var inner = new paper.Path.Circle({
        center: defaultProject.view.center,
        radius: 100,
        parent: originals,
        fillColor: "blue",
      });

      var outer = new paper.Path.Circle({
        center: defaultProject.view.center,
        radius: 140,
        parent: originals,
        fillColor: "green",
      });

      var ring = outer.subtract(inner);

      var operations = ["unite", "intersect", "subtract", "exclude", "divide"];
      var colors = ["red", "green", "blue", "black"];
      var curIndex = -1;
      var operation, result, activeItem;

      // Change the mode every 3 seconds:
      setInterval(setMode, 3000);

      // Set the initial mode:
      setMode();

      function setMode() {
        curIndex++;
        if (curIndex == operations.length * 2) curIndex = 0;
        operation = operations[curIndex % operations.length];
      }

      function onMouseDown(event) {
        var hitResult = originals.hitTest(event.point);
        activeItem = hitResult && hitResult.item;
      }

      function onMouseDrag(event) {
        if (activeItem) activeItem.position = event.point;
      }

      function onMouseUp() {
        activeItem = null;
        square.position = defaultProject.view.center;
      }

      function onFrame(event) {
        console.log("=-=-=-=-=-0");
        if (activeItem != ring) {
          // Move the ring around:
          var offset =
            new paper.Point(140, 80) *
            [Math.sin(event.count / 60), Math.sin(event.count / 40)];
          ring.position = defaultProject.view.center + offset;
        }

        // Remove the result of the last path operation:
        if (result) result.remove();

        console.log("=-=-=-=-=-1111");

        // Perform the path operation on the ring:
        if (curIndex < operations.length) {
          result = square[operation](ring);
          text.content = "square." + operation + "(ring)";
        } else {
          result = ring[operation](square);
          text.content = "ring." + operation + "(square)";
        }
        result.selected = true;
        result.fillColor = colors[curIndex % colors.length];
        result.moveBelow(text);
        console.log("=-=-=-=-=-");

        // If the result is a group, color each of its children differently:
        if (result instanceof paper.Group) {
          for (var i = 0; i < result.children.length; i++) {
            result.children[i].fillColor = colors[i];
          }
        }
        // defaultProject.view.draw();
        console.log("=-=-=-=-=-22222");
        console.log(text);
      }

      function onResize() {
        text.position = defaultProject.view.center + [0, 200];
        square.position = defaultProject.view.center;
      }

      //   const tool = new paper.Tool();

      //   tool.onMouseDown = onMouseDown;
      //   tool.onMouseDrag = onMouseDrag;
      //   tool.onMouseUp = onMouseUp;

      defaultProject.view.onFrame = onFrame;
      defaultProject.view.onResize = onResize;

      // defaultProject.view.draw();
    </script>
  </body>
</html>
