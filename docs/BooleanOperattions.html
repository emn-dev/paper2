<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Path Intersections</title>
    <style>
      /* Scale canvas with resize attribute to full size */
      canvas[resize] {
        width: 100%;
        height: 100%;
        background-color: lightgray;
      }
    </style>
    <!-- <script src="https://unpkg.com/paper@0.12.18/dist/paper-full.js"></script> -->
  </head>
  <body>
    <nav>
      <table style="width: 300px; background-color: lightgray; margin: 0 auto">
        <tr>
          <td><a href="index.html">home</a>&nbsp;|&nbsp;</td>
          <td><a href="straps.html">straps</a>&nbsp;|&nbsp;</td>
          <td><a href="simple.html">simple</a>&nbsp;|&nbsp;</td>
          <td><a href="BooleanOperattions.html">BooleanOperattions</a></td>
        </tr>
      </table>
    </nav>
    <header style="text-align: center"><h1>paper2 current version</h1></header>
    <main>
      <canvas id="myCanvas" resize></canvas>
    </main>
    <!-- <script canvas="myCanvas" type="text/paperscript"> -->
    <script type="module">
      // import * as paper2Module from "https://unpkg.com/paper2/paper2.esm.js";
      import * as paper2Module from "./paper2.esm.js";
      window.paper = paper2Module.paper;
      // paper.install(window);
      paper.setup("myCanvas");

      var text = new paper.PointText({
        position: paper.view.center + [0, 200],
        fillColor: "black",
        justification: "center",
        fontSize: 20,
      });

      var originals = new paper.Group({ insert: false }); // Don't insert in DOM.

      var square = new paper.Path.Rectangle({
        position: paper.view.center,
        size: 300,
        parent: originals,
        fillColor: new paper.Color("red"),
      });

      // Make a ring using subtraction of two circles:
      var inner = new paper.Path.Circle({
        center: paper.view.center,
        radius: 100,
        parent: originals,
        // fillColor: "blue",
        fillColor: new paper.Color("blue"),
      });

      var outer = new paper.Path.Circle({
        center: paper.view.center,
        radius: 140,
        parent: originals,
        // fillColor: "green",
        fillColor: new paper.Color("green"),
      });

      var ring = outer.subtract(inner);

      var operations = ["unite", "intersect", "subtract", "exclude", "divide"];
      var colors = ["red", "green", "blue", "black"];
      var curIndex = -1;
      var operation, result, activeItem;

      // Change the mode every 3 seconds:
      setInterval(setMode, 3000);

      // Set the initial mode:
      setMode();

      function setMode() {
        curIndex++;
        if (curIndex == operations.length * 2) curIndex = 0;
        operation = operations[curIndex % operations.length];
      }

      function onMouseDown(event) {
        var hitResult = originals.hitTest(event.point);
        activeItem = hitResult && hitResult.item;
      }

      function onMouseDrag(event) {
        if (activeItem) activeItem.position = event.point;
      }

      function onMouseUp() {
        activeItem = null;
        square.position = paper.view.center;
      }

      function onFrame(event) {
        if (activeItem != ring) {
          // Move the ring around:
          var offset =
            new paper.Point(140, 80) *
            [Math.sin(event.count / 60), Math.sin(event.count / 40)];
          ring.position = paper.view.center + offset;
        }

        // console.log("=as-df=as-fs=daasf");
        // console.log(result);

        // Remove the result of the last path operation:
        if (result) result.remove();

        // Perform the path operation on the ring:
        if (curIndex < operations.length) {
          result = square[operation](ring);
          text.content = "square." + operation + "(ring)";
        } else {
          result = ring[operation](square);
          text.content = "ring." + operation + "(square)";
        }
        result.selected = true;
        result.fillColor = colors[curIndex % colors.length];
        result.moveBelow(text);

        // If the result is a group, color each of its children differently:
        if (result instanceof paper.Group) {
          for (var i = 0; i < result.children.length; i++) {
            result.children[i].fillColor = colors[i];
          }
        }
        // paper.view.draw();
      }

      function onResize() {
        text.position = paper.view.center + [0, 200];
        square.position = paper.view.center;
      }

      paper.view.onFrame = onFrame;
      paper.view.onResize = onResize;
      paper.view.onMouseDown = onMouseDown;
      paper.view.onMouseDrag = onMouseDrag;
      paper.view.onMouseUp = onMouseUp;
    </script>
  </body>
</html>
